<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="app_title">AIDE RAP</title>
    <script>
      // Early theme application (before CSS renders) to prevent flash
      (function() {
        var t = localStorage.getItem('rap-settings-theme') || 'system';
        if (t === 'system') t = matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        if (t === 'dark') document.documentElement.dataset.theme = 'dark';
      })();
    </script>
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="/static/frame/css/base.css">
    <link rel="stylesheet" href="/static/rap/rap.css">
    <!-- Leaflet for geo field maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <!-- Leaflet MarkerCluster for map views -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <!-- Vega-Lite for chart views -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <!-- Mermaid for ER diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <!-- Marked for markdown rendering (processes) -->
    <script src="/static/frame/vendor/marked/marked.min.js"></script>
</head>
<body>
    <div class="app-container page-fill">
        <!-- Framework Header Widget -->
        <div id="app-header"></div>

        <!-- Breadcrumb Bar (reserved for navigation) -->
        <nav id="rap-menu-bar" class="rap-menu-bar">
        </nav>

        <!-- Modal Container (for Seed Manager and other tools) -->
        <div id="modal-container"></div>

        <!-- Main Content Area -->
        <main class="main-content">
            <div class="content-split">
                <!-- Entity Explorer (left) -->
                <section id="entity-explorer" class="entity-explorer">
                    <!-- Toolbar -->
                    <div class="explorer-toolbar">
                        <!-- View mode toggle: Table / Tree-H / Tree-V -->
                        <div class="view-mode-buttons">
                            <button id="btn-view-table" class="btn-view-mode" title="Table view" data-i18n-title="tooltip_table_view">
                                <!-- Grid/Table icon -->
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                                    <rect x="0" y="0" width="6" height="3"/><rect x="8" y="0" width="6" height="3"/>
                                    <rect x="0" y="5" width="6" height="3"/><rect x="8" y="5" width="6" height="3"/>
                                    <rect x="0" y="10" width="6" height="3"/><rect x="8" y="10" width="6" height="3"/>
                                </svg>
                            </button>
                            <button id="btn-view-tree-h" class="btn-view-mode" title="Tree view (horizontal attributes)" data-i18n-title="tooltip_tree_view_h">
                                <!-- Tree with horizontal bars -->
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                                    <rect x="0" y="0" width="14" height="2"/>
                                    <rect x="2" y="4" width="12" height="2"/>
                                    <rect x="4" y="8" width="5" height="2"/><rect x="10" y="8" width="4" height="2"/>
                                    <rect x="4" y="12" width="10" height="2"/>
                                </svg>
                            </button>
                            <button id="btn-view-tree-v" class="btn-view-mode active" title="Tree view (vertical attributes)" data-i18n-title="tooltip_tree_view_v">
                                <!-- Tree with vertical bar indicating stacked layout -->
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                                    <rect x="0" y="0" width="14" height="2"/>
                                    <rect x="2" y="4" width="2" height="10"/>
                                    <rect x="6" y="12" width="8" height="2"/>
                                </svg>
                            </button>
                            <button id="btn-view-hierarchy" class="btn-view-mode" title="Hierarchy view" data-i18n-title="tooltip_hierarchy_view" style="display:none">
                                <!-- Org chart / hierarchy icon -->
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="9" y="2" width="6" height="4" rx="1"/>
                                    <rect x="2" y="18" width="6" height="4" rx="1"/>
                                    <rect x="9" y="18" width="6" height="4" rx="1"/>
                                    <rect x="16" y="18" width="6" height="4" rx="1"/>
                                    <path d="M12 6v6M5 18v-4h14v4"/>
                                </svg>
                            </button>
                            <button id="btn-view-map" class="btn-view-mode" title="Map view" data-i18n-title="tooltip_map_view" style="display:none">
                                <!-- Map marker icon -->
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                                    <path d="M7 0C4.5 0 2.5 2 2.5 4.5C2.5 8 7 14 7 14S11.5 8 11.5 4.5C11.5 2 9.5 0 7 0ZM7 6.5C5.9 6.5 5 5.6 5 4.5S5.9 2.5 7 2.5S9 3.4 9 4.5S8.1 6.5 7 6.5Z"/>
                                </svg>
                            </button>
                            <button id="btn-view-chart" class="btn-view-mode" title="Chart view" data-i18n-title="tooltip_chart_view" style="display:none">
                                <!-- Bar chart icon -->
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                                    <rect x="0" y="8" width="3" height="6"/>
                                    <rect x="4" y="4" width="3" height="10"/>
                                    <rect x="8" y="6" width="3" height="8"/>
                                    <rect x="12" y="2" width="2" height="12"/>
                                </svg>
                            </button>
                            <label id="map-labels-toggle" class="map-labels-toggle" style="display:none" title="Show marker labels" data-i18n-title="tooltip_show_labels">
                                <input type="checkbox" id="map-show-labels" checked>
                                <span data-i18n="map_labels">Labels</span>
                            </label>
                        </div>
                        <div id="process-selector" class="process-selector-dropdown" style="display:none">
                            <button class="process-selector-trigger">
                                <span class="process-selector-text" data-i18n="select_process">Select Process...</span>
                            </button>
                            <div class="process-selector-menu"></div>
                        </div>
                        <button id="btn-process-toggle" class="btn-icon process-toggle-btn" title="Toggle process view" data-i18n-title="tooltip_toggle_process" style="display:none">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/>
                                <rect x="9" y="3" width="6" height="4" rx="1"/>
                                <path d="M9 14l2 2 4-4"/>
                            </svg>
                        </button>
                        <div id="view-selector" class="view-selector-dropdown" style="display:none">
                            <button class="view-selector-trigger">
                                <span class="view-selector-text" data-i18n="select_view">Select View...</span>
                            </button>
                            <div class="view-selector-menu"></div>
                        </div>
                        <button id="btn-data-model" class="btn-icon" title="Show data model" data-i18n-title="tooltip_data_model">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="3" width="7" height="5" rx="1"/>
                                <rect x="15" y="3" width="7" height="5" rx="1"/>
                                <rect x="8" y="16" width="8" height="5" rx="1"/>
                                <path d="M5.5 8v4h13v-4M12 12v4"/>
                            </svg>
                        </button>
                        <div id="entity-selector" class="entity-selector-dropdown">
                            <button class="entity-selector-trigger">
                                <span class="entity-selector-text" data-i18n="select_entity">Select Entity...</span>
                            </button>
                            <div class="entity-selector-menu"></div>
                        </div>
                        <button id="btn-refresh-counts" class="btn-icon" title="Refresh counts" data-i18n-title="tooltip_refresh_counts">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M23 4v6h-6M1 20v-6h6"/>
                                <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                            </svg>
                        </button>
                        <a href="/about?doc=index.md" class="btn-icon" title="Documentation" data-i18n-title="tooltip_documentation">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <!-- Two stacked rectangles (class diagram style) -->
                                <rect x="3" y="3" width="8" height="7" rx="1"/>
                                <rect x="13" y="3" width="8" height="7" rx="1"/>
                                <rect x="8" y="14" width="8" height="7" rx="1"/>
                                <line x1="7" y1="10" x2="12" y2="14"/>
                                <line x1="17" y1="10" x2="12" y2="14"/>
                            </svg>
                        </a>
                    </div>

                    <!-- Entity Table (table view) -->
                    <div id="entity-table-container" class="entity-list hidden">
                    </div>

                    <!-- Entity Tree (tree view) -->
                    <div id="entity-tree-container" class="entity-list hidden">
                    </div>

                    <!-- Entity Map (map view) -->
                    <div id="entity-map-container" class="entity-map hidden">
                    </div>

                    <!-- Entity Chart (chart view) -->
                    <div id="entity-chart-container" class="entity-chart hidden">
                    </div>

                    <!-- Welcome Screen (shown when nothing selected) -->
                    <div id="welcome-container" class="welcome-screen">
                    </div>

                    <!-- Process Panel (process view) -->
                    <div id="process-panel-container" class="process-panel hidden">
                    </div>
                </section>

                <!-- Detail Panel (right) -->
                <aside id="detail-panel" class="detail-panel">
                    <div class="panel-header">
                        <span id="panel-title" class="panel-title" data-i18n="details">Details</span>
                        <button id="panel-toggle" class="panel-toggle" title="Collapse panel" data-i18n-title="tooltip_collapse_panel">&#9666;</button>
                    </div>
                    <div id="panel-content" class="panel-content">
                        <p class="empty-message" data-i18n="select_record_message">Select a record to view details.</p>
                    </div>
                </aside>

                <!-- Collapsed Panel Toggle -->
                <button id="panel-expand" class="panel-expand hidden" title="Expand panel" data-i18n-title="tooltip_expand_panel">&#9656;</button>
            </div>

            <!-- Framework Status Widget (Footer) -->
            <div id="status-widget" class="status-widget"></div>
        </main>
    </div>

    <!-- Conflict Dialog Template (OCC) -->
    <dialog id="conflict-dialog" class="conflict-dialog">
        <div class="dialog-content">
            <h3 id="conflict-title" data-i18n="conflict_title">Version Conflict</h3>
            <p class="conflict-message" data-i18n="conflict_message">
                This record was modified by another user. Please review the changes:
            </p>
            <div id="conflict-diff" class="conflict-diff"></div>
            <div class="dialog-buttons">
                <button id="conflict-cancel" class="btn-secondary" data-i18n="cancel">Cancel</button>
                <button id="conflict-reload" class="btn-primary" data-i18n="reload_changes">Load Server Version</button>
                <button id="conflict-overwrite" class="btn-danger" data-i18n="overwrite">Overwrite</button>
            </div>
        </div>
    </dialog>

    <!-- Confirm Dialog Template -->
    <dialog id="confirm-dialog" class="confirm-dialog">
        <div class="dialog-content">
            <p id="confirm-message"></p>
            <label class="checkbox-row" id="confirm-remember-row">
                <input type="checkbox" id="confirm-remember">
                <span data-i18n="dont_ask_again">Don't ask again this session</span>
            </label>
            <div class="dialog-buttons">
                <button id="confirm-cancel" class="btn-secondary" data-i18n="cancel">Cancel</button>
                <button id="confirm-ok" class="btn-danger" data-i18n="delete">Delete</button>
            </div>
        </div>
    </dialog>

    <!-- Framework Scripts -->
    <script src="/static/frame/vendor/polyglot/polyglot.min.js"></script>
    <script src="/static/frame/js/vendor/qrcode-generator/qrcode.min.js"></script>
    <script src="/static/frame/js/i18n.js"></script>
    <script src="/static/frame/js/google-translate.js"></script>
    <script src="/static/frame/js/header-widget.js"></script>
    <script src="/static/frame/js/status-widget.js"></script>
    <script src="/static/frame/js/pwa.js"></script>

    <!-- RAP Scripts -->
    <script src="/static/rap/utils/DomUtils.js"></script>
    <script src="/static/rap/utils/ColumnUtils.js"></script>
    <script src="/static/rap/services/api-client.js"></script>
    <script src="/static/rap/components/context-menu.js"></script>
    <!-- Entity Tree modules (must load before entity-tree.js) -->
    <script src="/static/rap/components/entity-tree-state.js"></script>
    <script src="/static/rap/components/entity-tree-renderer.js"></script>
    <script src="/static/rap/components/entity-tree-pdf.js"></script>
    <script src="/static/rap/components/entity-tree.js"></script>
    <script src="/static/rap/components/entity-table.js"></script>
    <script src="/static/rap/components/entity-map.js"></script>
    <script src="/static/rap/components/entity-chart.js"></script>
    <script src="/static/rap/components/hierarchy-tree.js"></script>
    <script src="/static/rap/components/process-panel.js"></script>
    <script src="/static/rap/components/entity-explorer.js"></script>
    <script src="/static/rap/components/data-model-diagram.js"></script>
    <script src="/static/rap/components/breadcrumb-nav.js"></script>
    <script src="/static/rap/components/breadcrumb-share-dialog.js"></script>
    <script src="/static/rap/components/detail-panel.js"></script>
    <script src="/static/rap/components/media-upload.js"></script>
    <script src="/static/rap/components/media-browser.js"></script>
    <script src="/static/rap/components/entity-form.js"></script>
    <script src="/static/rap/components/conflict-dialog.js"></script>
    <script src="/static/rap/utils/CsvParser.js"></script>
    <script src="/static/rap/utils/DialogUtils.js"></script>
    <script src="/static/rap/components/seed-import-dialog.js"></script>
    <script src="/static/rap/components/seed-manager.js"></script>
    <script src="/static/rap/components/seed-generator-dialog.js"></script>
    <script src="/static/rap/components/model-builder-dialog.js"></script>
    <script src="/static/rap/components/login-dialog.js"></script>
    <script src="/static/rap/rap.js"></script>
</body>
</html>
